#!/usr/bin/env bash
# Main entry point for Claude Code Sessions Manager.
# Routes subcommands to the appropriate Python handler.

set -euo pipefail

# Resolve the directory where this script lives
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

# Print usage information
show_help() {
    cat <<'EOF'
Usage: claude-code-sessions [COMMAND] [OPTIONS]

Claude Code Session Manager - Browse, resume, and delete Claude Code sessions.

Commands:
  (none)              Launch the interactive session browser
  ls                  List all sessions in a compact format
  launch <ID>         Resume a session by its ID
  delete <ID>         Delete a session and all its data

Options:
  -h, --help          Show this help message and exit

Examples:
  claude-code-sessions                    # Open interactive browser
  claude-code-sessions ls                 # List all sessions
  claude-code-sessions launch abc123      # Resume session abc123
  claude-code-sessions delete abc123      # Delete session abc123
EOF
}

# Main routing
case "${1:-}" in
    -h|--help)
        show_help
        exit 0
        ;;
    ls)
        PYTHONPATH="$SCRIPT_DIR" python3 -m src.commands.ls
        ;;
    launch)
        if [[ -z "${2:-}" ]]; then
            echo "Error: 'launch' requires a session ID argument." >&2
            echo "Usage: claude-code-sessions launch <SESSION_ID>" >&2
            exit 1
        fi
        PYTHONPATH="$SCRIPT_DIR" python3 -m src.commands.launch "$2"
        ;;
    delete)
        if [[ -z "${2:-}" ]]; then
            echo "Error: 'delete' requires a session ID argument." >&2
            echo "Usage: claude-code-sessions delete <SESSION_ID>" >&2
            exit 1
        fi
        PYTHONPATH="$SCRIPT_DIR" python3 -m src.commands.delete "$2"
        ;;
    "")
        # No arguments: launch interactive TUI
        PYTHONPATH="$SCRIPT_DIR" python3 -m src.tui.app
        ;;
    *)
        echo "Error: Unknown command '$1'." >&2
        echo "Run 'claude-code-sessions --help' for usage information." >&2
        exit 1
        ;;
esac
